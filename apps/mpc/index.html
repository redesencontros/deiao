<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MPC Virtual</title>

<style>
html {
    background: transparent;
}
body{
        margin:0;
    background: transparent;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Arial, sans-serif;
    user-select:none;
}

#mpcBody{
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    align-items:center;

    filter: blur(6px);
    transition: filter 0.4s ease;
}


/* Overlay superior */
#startOverlay {
    position: fixed;
    inset: 0;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

/* BotÃ£o play */
#playButton {
    font-size: 22px;
    padding: 18px 40px;
    background: rgb(215, 196, 25);
    color: black;
    border: none;
    cursor: pointer;
    letter-spacing: 3px;
    transition: transform 0.1s ease, background 0.2s ease;
    font-family: "PlayFont", sans-serif; /* ðŸ”¥ sÃ³ aqui */
}
@font-face {
    font-family: "PlayFont";
    src: url("https://redesencontros.github.io/dancaeissoaquio/assets/fonts/bozart.woff2") format("woff2");
    font-weight: normal;
    font-style: normal;
}

#playButton:active {
    transform: scale(0.95);
}
/* ===== CORPO 2D ===== */

#mpc{
    position:relative;

    height:60vh;              
    aspect-ratio: 1 / 1.1;    

    padding:clamp(30px, 6%, 80px) 
            clamp(25px, 5%, 60px) 
            clamp(30px, 6%, 80px) 
            clamp(25px, 5%, 60px);

    background:
    linear-gradient(145deg,
        #ffffff 0%,
        #f2f2f2 20%,
        #e6e6e6 40%,
        #f8f8f8 60%,
        #dddddd 80%,
        #ffffff 100%
    );

    background-size:4px 4px;

    display:flex;
    flex-direction:column;

    /* ðŸ”¥ Novo balanceamento */
    justify-content:space-between;
    align-items:center;
}

/* ===== PARAFUSOS ===== */

.screw{
    position:absolute;
    width:14px;
    height:14px;

    background:
        radial-gradient(circle at 35% 35%,
            #5a5a5a 0%,
            #3a3a3a 35%,
            #1a1a1a 70%,
            #000 100%
        );

    border-radius:50%;

    box-shadow:
        inset 0 1px 2px rgba(255,255,255,0.25),
        inset 0 -2px 4px rgba(0,0,0,0.8);
}

/* posiÃ§Ãµes */

#screwTL{ top:12px; left:12px; }
#screwTR{ top:12px; right:12px; }
#screwBL{ bottom:12px; left:12px; }
#screwBR{ bottom:12px; right:12px; }

/* ===== TELA ===== */

#screen{
    width:100%;

    /* ðŸ”¥ ProporÃ§Ã£o equilibrada */
    height:28%;
    min-height:60px;
    max-height:180px;

    background:#1b3b1b;

    /* ðŸ”¥ espaÃ§amento proporcional menor */
    margin-bottom:clamp(18px, 4%, 40px);

    box-shadow: inset 0 0 15px #000;
    color:#7CFF7C;

    display:flex;
    align-items:center;
    justify-content:center;
}

#screenText{
    font-size:clamp(9px, 5vh, 16px);
}

#screenText.blink {
    animation: blinkText 0.15s steps(2, start) 6;
}

@keyframes blinkText {
    to { opacity: 0; }
}


/* ===== GRID ===== */

#pads{
    width:100%;
    flex:1;

    display:grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);

    /* ðŸ”¥ leve ajuste no gap para compensar logo removida */
    gap:clamp(20px, 6%, 45px);
}



/* ===== PADS PRETOS ===== */

.pad{
    width:100%;
    aspect-ratio:1/1;

    background:linear-gradient(to bottom,#111,#000);
    border-radius:clamp(3px, 1%, 8px);

    box-shadow:
        0 0.6vw 0 #050505,
        inset 0 0 15px rgba(255,255,255,0.05),
        inset 0 -8px 12px rgba(0,0,0,0.9);

    cursor:pointer;
    transition:all 0.08s ease;
}


.pad.active{
    transform:translateY(6px);
    box-shadow:
        0 0 0 #050505,
        inset 0 0 25px #ff6600;
    background:linear-gradient(to bottom,#ff6600,#cc4400);
}

</style>
</head>
<body>

<div id="startOverlay">
    <button id="playButton">Vai DJ!</button>
</div>

<div id="mpc">
    <div id="mpcBody">
        <div id="screwTL" class="screw"></div>
        <div id="screwTR" class="screw"></div>
        <div id="screwBL" class="screw"></div>
        <div id="screwBR" class="screw"></div>
        <div id="screen">
            <span id="screenText">Ã© isso aqui, Ã³</span>
        </div>

        <div id="pads"></div>
    </div>
</div>


<script>
const screenText = document.getElementById("screenText");

let audioContext;
let baseBuffer;
let baseSource;
let padBuffers = {};
let currentPadSource = null;
let currentPadElement = null;
let masterCompressor;
let masterGain;

async function initBaseTrack() {

    const response = await fetch("https://redesencontros.github.io/dancaeissoaquio/mpc/audio/base.wav");
    const arrayBuffer = await response.arrayBuffer();
    baseBuffer = await audioContext.decodeAudioData(arrayBuffer);

    playBaseLoop();
}


function playBaseLoop() {

    baseSource = audioContext.createBufferSource();
    baseSource.buffer = baseBuffer;
    baseSource.loop = true;

    baseSource.connect(masterCompressor);
    baseSource.start(0);
}

async function loadPads() {
    for (let url of padSounds) {
        const response = await fetch(url);
        const arrayBuffer = await response.arrayBuffer();
        padBuffers[url] = await audioContext.decodeAudioData(arrayBuffer);
    }
}

const padSounds = [
    "https://redesencontros.github.io/dancaeissoaquio/mpc/audio/danca.wav","https://redesencontros.github.io/dancaeissoaquio/mpc/audio/hiphop.wav","https://redesencontros.github.io/dancaeissoaquio/mpc/audio/funk.wav",
    "https://redesencontros.github.io/dancaeissoaquio/mpc/audio/aovivo.wav","https://redesencontros.github.io/dancaeissoaquio/mpc/audio/lapragalera.wav","https://redesencontros.github.io/dancaeissoaquio/mpc/audio/caravaisertipoassim.wav",
    "https://redesencontros.github.io/dancaeissoaquio/mpc/audio/senteopassim.wav","https://redesencontros.github.io/dancaeissoaquio/mpc/audio/passim.wav","https://redesencontros.github.io/dancaeissoaquio/mpc/audio/muitochocante.wav"
];

const screen = document.getElementById("screen");
const padContainer = document.getElementById("pads");

// Criar pads
padSounds.forEach((sound, i)=>{
    const pad = document.createElement("div");
    pad.classList.add("pad");
    pad.dataset.sound = sound;
    padContainer.appendChild(pad);

    pad.addEventListener("pointerdown", () => triggerPad(pad));
});

function triggerPad(pad){

    const buffer = padBuffers[pad.dataset.sound];
    if (!buffer) return;
    
    // ===== VISOR =====
const fileName = pad.dataset.sound.split("/").pop().replace(".wav", "");
screenText.textContent = fileName;
screenText.classList.remove("blink");
void screenText.offsetWidth; // forÃ§a reinÃ­cio da animaÃ§Ã£o
screenText.classList.add("blink");

screen.classList.remove("blink"); // reset se clicar rÃ¡pido
void screen.offsetWidth;          // forÃ§a reflow
screen.classList.add("blink");


    const now = audioContext.currentTime;

    // Fade out rÃ¡pido do que estiver tocando (evita click digital)
    if (currentPadSource) {
        try {
            currentPadSource.gainNode.gain.cancelScheduledValues(now);
            currentPadSource.gainNode.gain.setValueAtTime(
                currentPadSource.gainNode.gain.value,
                now
            );
            currentPadSource.gainNode.gain.linearRampToValueAtTime(0, now + 0.005);
            currentPadSource.stop(now + 0.005);
        } catch(e){}
    }

    // Criar novo source
    const source = audioContext.createBufferSource();
    const gainNode = audioContext.createGain();

    source.buffer = buffer;
    source.connect(gainNode);
    gainNode.connect(masterCompressor);

    gainNode.gain.setValueAtTime(1, now);

    source.start(now);

    // Guardar referÃªncia
    source.gainNode = gainNode;
    currentPadSource = source;
    currentPadElement = pad;

    // ðŸ”¥ AnimaÃ§Ã£o visual independente do Ã¡udio
    pad.classList.add("active");

    setTimeout(() => {
        pad.classList.remove("active");
    }, 120);
}

const overlay = document.getElementById("startOverlay");
const playButton = document.getElementById("playButton");
const mpc = document.getElementById("mpc");

playButton.addEventListener("click", async () => {

    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    // ===== MASTER =====
masterCompressor = audioContext.createDynamicsCompressor();
masterCompressor.threshold.value = -18;
masterCompressor.ratio.value = 4;
masterCompressor.attack.value = 0.003;
masterCompressor.release.value = 0.2;

masterGain = audioContext.createGain();
masterGain.gain.value = 1;

masterCompressor.connect(masterGain);
masterGain.connect(audioContext.destination);


    if (audioContext.state === "suspended") {
        await audioContext.resume();
    }

    await initBaseTrack();
await loadPads();


    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
    const mpcBody = document.getElementById("mpcBody");
mpcBody.style.filter = "blur(0px)";

});

</script>
</body>
</html>
